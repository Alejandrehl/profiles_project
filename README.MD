# Profiles Project

### Commands

- `python3 manage.py makemigrations MIGRATION_NAME`: command to create a migration.
- `python3 manage.py makemigrations`: command to create a migration with auto name.
- `python3 manage.py migrate`: command to run migrations.
- `python3 manage.py createsuperuser`: command to create a super user for django admin.

### Django REST Framework Views

1. APIView: Describe logic to make API endpoint.

   - Use standart HTTP Methods for functions.
   - Give you the most controler over the logic:

     1. Perfect for implementing complex logic.
     2. Calling other APIs.
     3. Working with local files.

   - When to use APIViews?

     1. Need full control over logic such as when you running a very complicated algorithm or update multiples resources in one API call.
     2. Processing files and rendering a synchronous response.
     3. You are calling other external APIs or services in same request.
     4. Accessing local files or data.

2. ViewSet

   - Uses model operations for functions.
   - Takes care of a lot of typical logic for you.
   - Perfect for standard database operations.
   - Fastest way to make a database interface.

   - When to use ViewSets?

     1. A simple CRUD interface to your database.
     2. A quick and simple API.
     3. Little to no customization on the logic.
     4. Working with standard data structures.

### Serializer

Serializer is a feature from Django REST Framework that allows you to easily convert data inputs into Python objects and viceversa.

### Permissions

- Add `from rest_framework.permissions import NAME`
- IsAuthenticated: Allow access to resources just authenticated users.
- IsAuthenticatedOrReadOnly: Allow access just to read resources. (Get All, Get by Id).

### Notes & Tricks

- Activate Django Admin: To activate Django Admin you edit your admin.py:
  1. Import dependencie: `from profiles_api import models`
  2. Register model: `admin.site.register(models.UserProfile)`

### Tools

- ModHeader: Chrome extension to modify HTTP request and response headers.

### AWS Deployment Steps

1. Sign in [AWS](https://aws.amazon.com/)
2. Go to console
3. Go to EC2
4. ### Import new Key Pair
   - Add Name, example: `Alejandro-MacbookPro-16`
   - Use `cat ~/.ssh/id_rsa.pub` in terminal and copy/paste the key.
5. ### Create EC2 Server instance
   - Click `Launch Instances`
   - Select Ubuntu LTS
   - Select t2.micro (Free tier)
   - Select `6. Configure Security Group`
   - Add new HTTP Rule
   - Click `Review and Launch`
   - Click `Launch`
   - Select a Key Pair created previously
   - Launch Instance
6. ### Configure Deploy
   - Create & config `deploy` folder.
   - setup.sh: File to config Server, Folders, Dependencies and migrations.
   - update.sh: Update the code on server when we make changes.
   - Config `DEBUG` in `settings.py`: `DEBUG = bool(int(os.environ.get('DEBUG', 1)))`.
   - Add `STATIC_ROOT` to `settings.py`: `STATIC_ROOT = "static/"`. This is the route where django will store all static files generated by `collecstatic` command.
   - Exec `chmod +x deploy/*.sh` in root folder.
7. ### Deploy to server
   - Go to EC2 instances
   - Click instance and copy the `Public IPv4 DNS`
   - Exec `ssh ubuntu@STRING_COPIED_DNS`: This command connect with your instance
   - Get raw url of your setup.sh file, example: `https://raw.githubusercontent.com/Alejandrehl/profiles_project/master/deploy/setup.sh`
   - Exec `curl -sl https://raw.githubusercontent.com/Alejandrehl/profiles_project/master/deploy/setup.sh | sudo bash -` in instance terminal windows
8. ### Update allowed hosts and deploy changes

```python3
ALLOWED_HOSTS = [
    "http://ec2-3-23-129-101.us-east-2.compute.amazonaws.com/",
    "127.0.0.1"
]
```
